"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[20731],{20731:(e,t,n)=>{n.r(t),n.d(t,{UserRolesList:()=>Z});var l=n(24184),r=n(54833),o=n(93129),s=n(86727),a=n(26109),i=n(44194),u=n(10479),d=n(47245),c=n(47018),m=n(62508),p=n(89141),f=n(77757),v=n(24393),g=n(12742),h=n(45770),y=n(12886),b=n(92325);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);t&&(l=l.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,l)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function O(e,t,n){var l;return l=function(e,t){if("object"!=E(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var l=n.call(e,t||"default");if("object"!=E(l))return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==E(l)?l:l+"")in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||w(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,o,s,a=[],i=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(l=o.call(n)).done)&&(a.push(l.value),a.length!==t);i=!0);}catch(e){u=!0,r=e}finally{try{if(!i&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw r}}return a}}(e,t)||w(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=new Array(t);n<t;n++)l[n]=e[n];return l}var Z=function(e){var t,n,E,R=e.onAlertFired,O=e.user,w=e.handleUserUpdate,C=e.isGroupAndRoleSeparationEnabled,Z=e.permissionsToHide,j=e.realmConfigs,k=e.hideApplicationRoles,P=(0,u.$)().t,M=(0,s.fQ)().getLink,N=(0,d.v9)((function(e){return e.config.ui.features})),H=(0,d.v9)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.allowedScopes})),T=A((0,i.useState)(!1),2),F=T[0],I=T[1],Q=A((0,i.useState)([]),2),D=Q[0],X=Q[1],x=A((0,i.useState)([]),2),V=x[0],_=x[1],G=A((0,i.useState)([]),2)[1],J=A((0,i.useState)(void 0),2),q=J[0],B=J[1],L=A((0,i.useState)(void 0),2),$=L[0],z=L[1],K=A((0,i.useState)(!1),2)[1],W=A((0,i.useState)(!1),2),Y=W[0],ee=W[1],te=A((0,i.useState)(""),1)[0],ne=A((0,i.useState)(!1),2),le=ne[0],re=ne[1],oe=A((0,i.useState)(!1),2),se=oe[0],ae=oe[1],ie=A((0,i.useState)(),1)[0],ue=A((0,i.useState)(!1),2),de=ue[0],ce=ue[1],me=A((0,i.useState)(!1),2),pe=me[0],fe=me[1],ve=A((0,i.useState)([]),2)[1],ge=A((0,i.useState)([]),2),he=ge[0],ye=ge[1],be=A((0,i.useState)(!1),2),Ee=be[0],Re=be[1],Se=A((0,i.useState)(!1),2),Oe=Se[0],Ue=Se[1],Ae=(0,d.v9)((function(e){var t;return null==e||null===(t=e.auth)||void 0===t?void 0:t.username})).split("@");Ae.pop();var we=Ae.join("@");(0,i.useEffect)((function(){te&&le&&He()}),[le]),(0,i.useEffect)((function(){ie&&de&&ae(!0)}),[de]),(0,i.useEffect)((function(){ve(he)}),[he]),(0,i.useEffect)((function(){if(O){if(!k)return ye(O.roles),je(),void Ce();ye(O.roles.filter((function(e){var t,n;return 2!==(null===(t=e.display)||void 0===t?void 0:t.split("/").length)&&"Application"!==(null===(n=e.display)||void 0===n?void 0:n.split("/")[0])}))),je(),Ce()}}),[O]),(0,i.useEffect)((function(){O&&Ze()}),[O.roles&&q]),(0,i.useEffect)((function(){fe(!0),(0,g.Sd)(null).then((function(e){var t=e.data.Resources;k&&t&&t instanceof Array&&(e.data.Resources=t.filter((function(e){var t;return(null===(t=e.displayName)||void 0===t||!t.includes(h.Fn))&&e}))),B(e.data.Resources)})).finally((function(){fe(!1)}))}),[]);var Ce=function(){if(C)ve(k?he:null==O?void 0:O.roles);else{var e,t=[];null==O||null===(e=O.groups)||void 0===e||e.map((function(e){var n,l=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/");if((null==l?void 0:l.length)>1&&(l[0]==h.Fn||l[0]==h.eT)){if(k&&"Application"===e[0]&&2===e.length)return;t.push(e)}})),ye(t),ve(t)}},Ze=function(){var e=q?U(q):[],t=[];if(e&&$){var n=Array.from(null==$?void 0:$.values());(0,a.Z)(e,(function(e){null!=n&&n.includes(e.id)&&t.push(e)}))}_(t),X(e),G(e),K(e.length===t.length)},je=function(){var e=new Map;if(C)O.roles&&O.roles instanceof Array&&((0,a.Z)(O.roles,(function(t){var n,l=null==t||null===(n=t.display)||void 0===n?void 0:n.split("/");if((null==l?void 0:l.length)>=1&&null!=t&&t.value){if(k&&"Application"===l[0]&&2===l.length)return;e.set(null==t?void 0:t.display,null==t?void 0:t.value)}})),z(e));else{var t=new Map;O.groups&&O.groups instanceof Array&&((0,a.Z)(O.groups,(function(e){var n,l=null==e||null===(n=e.display)||void 0===n?void 0:n.split("/");if((null==l?void 0:l.length)>=1){if(k&&"Application"===e[0]&&2===e.length)return;null==t||t.set(e.display,e.value)}})),z(t))}},ke=function(e,t){var n,l=[];t.map((function(e){l.push(e.id)}));var r={Operations:[],failOnErrors:1,schemas:["urn:ietf:params:scim:api:messages:2.0:BulkRequest"]},s={data:{Operations:[{op:"remove",path:"users[value eq "+e.id+"]"}],schemas:["urn:ietf:params:scim:schemas:core:2.0:Role"]},method:"PATCH"},a={data:{Operations:[{op:"add",value:{users:[{value:e.id}]}}],schemas:["urn:ietf:params:scim:schemas:core:2.0:Role"]},method:"PATCH"},i=[],u=[],d=[],c=[];$&&(d=U($.values())),(null==l?void 0:l.length)>0&&l.map((function(e){var t;null!==(t=d)&&void 0!==t&&t.includes(e)?d.splice(d.indexOf(e),1):c.push(e)})),d&&(null===(n=d)||void 0===n?void 0:n.length)>0&&(d.map((function(e){s=S(S({},s),{path:"/Roles/"+e}),i.push(s)})),i.map((function(e){r.Operations.push(e)}))),c&&(null==c?void 0:c.length)>0&&(c.map((function(e){a=S(S({},a),{path:"/Roles/"+e}),u.push(a)})),u.map((function(e){r.Operations.push(e)}))),Re(!0),(0,v.fU)(r).then((function(t){var n,l,r,s,a=null;try{a=JSON.parse(t.data.Operations[1].response).scimType}catch(i){a=P("user:updateUser.roles.notifications.updateUserRoles.error.message")}400===(null==t||null===(n=t.data)||void 0===n||null===(n=n.Operations[0])||void 0===n?void 0:n.status.code)&&400===(null==t||null===(l=t.data)||void 0===l||null===(l=l.Operations[1])||void 0===l?void 0:l.status.code)?(R({description:a,level:o.QU.ERROR,message:P("user:updateUser.roles.notifications.updateUserRoles.error.message")}),Ze()):400===(null==t||null===(r=t.data)||void 0===r||null===(r=r.Operations[0])||void 0===r?void 0:r.status.code)||400===(null==t||null===(s=t.data)||void 0===s||null===(s=s.Operations[1])||void 0===s?void 0:s.status.code)?(R({description:a,level:o.QU.WARNING,message:P("user:updateUser.roles.notifications.updateUserRoles.error.message")}),Ze()):(R({description:P("user:updateUser.roles.notifications.updateUserRoles.success.description"),level:o.QU.SUCCESS,message:P("user:updateUser.roles.notifications.updateUserRoles.success.message")}),I(!1),w(e.id))})).catch((function(e){var t,n,l,r;404!==(null==e||null===(t=e.response)||void 0===t?void 0:t.status)&&(null!=e&&e.response&&null!=e&&null!==(n=e.response)&&void 0!==n&&n.data&&null!=e&&null!==(l=e.response)&&void 0!==l&&null!==(l=l.data)&&void 0!==l&&l.description?R({description:null===(r=e.response)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.description,level:o.QU.ERROR,message:P("user:updateUser.roles.notifications.updateUserRoles.error.message")}):R({description:P("user:updateUser.roles.notifications.updateUserRoles.genericError.description"),level:o.QU.ERROR,message:P("user:updateUser.roles.notifications.updateUserRoles.genericError.message")}))})).finally((function(){Re(!1)}))},Pe=function(){K(!1),I(!1)},Me=function(){ae(!se),ce(!1)},Ne=function(){ee(!1),re(!1)},He=function(){ee(!0)};return i.createElement(i.Fragment,null,i.createElement(p.Z,null,i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,{width:16},i.createElement(s.pJ,{clearing:!0,"data-testid":"user-mgt-roles-list",className:"user-role-edit-header-segment",padded:"very"},i.createElement(p.Z,null,i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,null,i.createElement(s.X6,{as:"h4"},P("user:updateUser.roles.editRoles.heading")),i.createElement(s.X6,{subHeading:!0,ellipsis:!0,as:"h6"},!(0,r.Xr)(null==N?void 0:N.users,null==N||null===(t=N.users)||void 0===t||null===(t=t.scopes)||void 0===t?void 0:t.update,H)||(null==O?void 0:O.userName)===(null==j?void 0:j.adminUser)&&we!==(null==O?void 0:O.userName)?i.createElement(i.Fragment,null,"Add or remove the roles assigned to this user to control the user's access to different functionalities of the Console application."):i.createElement(i.Fragment,null,"Collaborators are assigned administrator permissions by default.",i.createElement(s.eb,{link:M("manage.users.collaboratorAccounts.roles.learnMore")},P("extensions:common.learnMore")))))),i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,{computer:10,tablet:16,mobile:16},pe?i.createElement(s.pO,null):i.createElement(s.pJ,null,i.createElement(f.Z.Group,null,i.createElement(m.Z,{hidden:!0}),null==D?void 0:D.map((function(e,t){var n,l,o=null==e||null===(n=e.displayName)||void 0===n?void 0:n.split("/");if((null==o?void 0:o.length)>=1&&!o.includes("everyone")&&!o.includes("system")&&!o.includes("selfsignup"))return i.createElement(i.Fragment,null,i.createElement(f.Z.Radio,{onChange:function(){return function(e){var t=[];t.push(e),_(t)}(e)},key:t,label:(null==o?void 0:o.length)>1?o[1]:o[0],checked:V.includes(e),"data-testid":"user-mgt-update-roles-modal-unselected-roles",readOnly:!(0,r.Xr)(null==N?void 0:N.users,null==N||null===(l=N.users)||void 0===l||null===(l=l.scopes)||void 0===l?void 0:l.update,H)||(null==O?void 0:O.userName)===(null==j?void 0:j.adminUser)&&we!==(null==O?void 0:O.userName)}),i.createElement(m.Z,{hidden:!0}))})))))),!(0,r.Xr)(null==N?void 0:N.users,null==N||null===(n=N.users)||void 0===n||null===(n=n.scopes)||void 0===n?void 0:n.update,H)||(null==O?void 0:O.userName)===(null==j?void 0:j.adminUser)&&we!==(null==O?void 0:O.userName)&&i.createElement(p.Z.Row,null,i.createElement(p.Z.Column,null,i.createElement(l.di,{when:null==N||null===(E=N.users)||void 0===E||null===(E=E.scopes)||void 0===E?void 0:E.create},i.createElement(s.KM,{"data-testid":"user-mgt-update-roles-modal-save-button",floated:"left",loading:Ee,disabled:Ee,onClick:function(){(null==V?void 0:V.length)>1?ke(O,V):Ue(!0)}},P("common:update"))))))))),i.createElement(y.r,{"data-testid":"user-mgt-roles-list-roles-permission-modal",openRolePermissionModal:Y,handleCloseRolePermissionModal:Ne,roleId:te,permissionsToHide:Z}),i.createElement(c.Z,{"data-testid":"user-mgt-update-roles-modal",open:F,size:"small",className:"user-roles"},i.createElement(c.Z.Header,null,P("user:updateUser.roles.addRolesModal.heading"),i.createElement(s.X6,{subHeading:!0,ellipsis:!0,as:"h6"},P("user:updateUser.roles.addRolesModal.subHeading"))),se&&i.createElement(i.Fragment,null,i.createElement(c.Z.Content,null,i.createElement(b.M,{"data-testid":"user-mgt-update-roles-modal-unselected-role-permissions",handleNavigateBack:Me,roleId:ie})),i.createElement(m.Z,{hidden:!0})),i.createElement(c.Z.Actions,null,i.createElement(p.Z,null,i.createElement(p.Z.Row,{column:2},i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8},i.createElement(s.Qj,{"data-testid":"user-mgt-update-roles-modal-cancel-button",floated:"left",onClick:Pe},P("common:cancel"))),i.createElement(p.Z.Column,{mobile:8,tablet:8,computer:8})))))),Oe&&i.createElement(s.cV,{"data-testid":"user-mgt-update-roles-confirmation-modal",onClose:function(){return Ue(!1)},type:"negative",open:Oe,assertionHint:P("user:updateUser.roles.editRoles.confirmationModal.assertionHint"),assertionType:"checkbox",primaryAction:P("common:confirm"),secondaryAction:P("common:cancel"),onSecondaryActionClick:function(){return Ue(!1)},onPrimaryActionClick:function(){ke(O,V),Ue(!1)},closeOnDimmerClick:!1},i.createElement(s.cV.Header,{"data-testid":"user-mgt-update-roles-confirmation-modal-header"},P("user:updateUser.roles.editRoles.confirmationModal.header")),i.createElement(s.cV.Message,{"data-testid":"user-mgt-update-roles-confirmation-modal-message",attached:!0,negative:!0},P("user:updateUser.roles.editRoles.confirmationModal.message")),i.createElement(s.cV.Content,{"data-testid":"user-mgt-update-roles-confirmation-modal-content"},P("user:updateUser.roles.editRoles.confirmationModal.content"))))};Z.defaultProps={hideApplicationRoles:!1,showDomain:!0}}}]);