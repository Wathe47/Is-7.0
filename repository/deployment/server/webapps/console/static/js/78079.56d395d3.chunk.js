"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[78079],{78079:(e,t,n)=>{n.r(t),n.d(t,{AuditLogsPage:()=>h,default:()=>E});var o=n(86727),i=n(44194),a=n(10479),r=n(26154),l=n(37077),c=n(24393),s=n(9569),u=n(2450),m=n(11098),f=n(87906),d=n(84419),p=n(49254);function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,a,r,l=[],c=!0,s=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=a.call(n)).done)&&(l.push(o.value),l.length!==t);c=!0);}catch(e){s=!0,i=e}finally{try{if(!c&&null!=n.return&&(r=n.return(),Object(r)!==r))return}finally{if(s)throw i}}return l}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return v(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var h=function(e){var t=e["data-componentid"],n=g((0,i.useState)(!1),2),v=n[0],h=n[1],E=g((0,i.useState)(!1),2),y=E[0],S=E[1],T=g((0,i.useState)(""),2),b=T[0],x=T[1],C=g((0,i.useState)(""),2),O=C[0],_=C[1],L=g((0,i.useState)(""),2),N=L[0],k=L[1],R=g((0,i.useState)(""),2),F=R[0],I=R[1],w=g((0,i.useState)(""),2),G=w[0],A=w[1],U=g((0,i.useState)(.25),2),j=U[0],D=U[1],M=g((0,i.useState)(new Map),2),H=M[0],Z=M[1],W=g((0,i.useState)([]),2),$=W[0],P=W[1],z=g((0,i.useState)(null),2),B=z[0],J=z[1],Q=g((0,i.useState)(!1),2),q=Q[0],K=Q[1],Y=g((0,i.useState)(!1),2),V=Y[0],X=Y[1],ee=g((0,i.useState)(""),2),te=ee[0],ne=ee[1],oe=g((0,i.useState)(.25),2),ie=oe[0],ae=oe[1],re=g((0,i.useState)(!1),2),le=re[0],ce=re[1],se=g((0,i.useState)(!1),2),ue=se[0],me=se[1],fe=g((0,i.useState)([]),2),de=fe[0],pe=fe[1],ge=(0,a.$)().t,ve="GMT+0000 UTC";(0,i.useEffect)((function(){setTimeout((function(){X(!0)}),m.LogsConstants.DELAY_MESSEGE_TIMEOUT),-1===j?K(!1):(K(!0),ue||(me(!0),setTimeout((function(){ce(!0),me(!1)}),m.LogsConstants.REFRESH_BUTTON_TIMEOUT)))}),[te]),(0,i.useEffect)((function(){ce(!1)}),[F,G,N,O]),(0,i.useEffect)((function(){var e=(0,p.getDateTimeWithOffset)(ve),t=e.toString(),n=(e-36e5*j).toString();I(t),A(n),ne(t),J({endTime:t,filter:"",limit:m.LogsConstants.LOG_FETCH_COUNT,logType:d.TabIndex.AUDIT_LOGS,startTime:n})}),[]);var he=(0,i.useRef)(null),Ee=(0,f.default)(B),ye=Ee.error,Se=Ee.list,Te=Ee.loading,be=Ee.next,xe=Ee.previous;(0,i.useEffect)((function(){pe(Se)}),[Se]);var Ce=function(e){var t=e.target;X(!1),0===t.scrollTop&&(xe?(J({filter:b,limit:m.LogsConstants.LOG_FETCH_COUNT,previousToken:xe}),h(!1),S(!1)):h(!0)),t.scrollHeight-t.scrollTop===t.clientHeight&&(be?(J({filter:b,limit:m.LogsConstants.LOG_FETCH_COUNT,nextToken:be}),S(!1),h(!1)):S(!0))},Oe=function(){var e="";H.forEach((function(t){e=e?"".concat(e," and logentry co '").concat(t,"'"):"logentry co '".concat(t,"'")})),_(e)},_e=function(){var e="";0===N.length?e=N:(e="logentry co '".concat(N,"'"),O&&(e=" and ".concat(e))),x(e);var t=G,n=F,o=(0,p.getDateTimeWithOffset)(ve);-1!==j&&(n=o.toString(),t=(o-36e5*j).toString()),X(!1),ne(o.toString()),ae(j),J({endTime:n,filter:"".concat(O).concat(e),limit:m.LogsConstants.LOG_FETCH_COUNT,logType:d.TabIndex.AUDIT_LOGS,startTime:t})},Le=function(){x(""),k(""),ce(!1)},Ne=function(e){var t=H;t.set(e.property,e.value),Z(t),Oe();var n=[];t.forEach((function(e,t){n.push({key:t,value:e})})),P(n)},ke=function(e){var t=H;t.delete(e),Z(t),Oe();var n=[];t.forEach((function(e,t){n.push({key:t,value:e})})),P(n)},Re=function(){var e=H;e.clear(),Z(e),Oe(),P([])},Fe=function(){return i.createElement("form",{className:"advance-search-form",onSubmit:function(e){e.preventDefault()}},i.createElement("div",{className:"search-input-wrapper"},i.createElement("div",{className:"search-box ui action left icon input advanced-search with-add-on"},i.createElement("input",{autoComplete:"off",placeholder:ge("extensions:develop.monitor.filter.searchBar.placeholderAudit"),maxLength:120,name:"query",type:"text",className:"search-input",value:N,onChange:function(e){return k(e.target.value)},"data-componentid":"".concat(t,"-search-input")}),i.createElement(r.Z,{name:"search",color:"grey"})),i.createElement("div",{className:"search-box-addons",hidden:!N},i.createElement(r.Z,{name:"close",color:"grey",onClick:Le,className:"icon-button"})),i.createElement("input",{hidden:!0,type:"submit",value:"Submit","data-componentid":"".concat(t,"-search-input-submit")})))},Ie=function(){return ye?i.createElement(o.$J,{subtitle:[ge("extensions:develop.monitor.notifications.genericError.subtitle.0"),ge("extensions:develop.monitor.notifications.genericError.subtitle.1")],title:ge("extensions:develop.monitor.notifications.genericError.title"),image:(0,c.jF)().genericError,imageSize:"tiny","data-componentid":"".concat(t,"-generic-error-placeholder")}):b&&0===Se.length?i.createElement(o.$J,{action:i.createElement(o.Qj,{onClick:Le},ge("extensions:develop.monitor.notifications.emptySearchResult.actionLabel")),image:(0,c.jF)().emptySearch,imageSize:"tiny",title:ge("extensions:develop.monitor.notifications.emptySearchResult.title"),subtitle:[ge("extensions:develop.monitor.notifications.emptySearchResult.subtitle.0"),ge("extensions:develop.monitor.notifications.emptySearchResult.subtitle.1")],"data-componentid":"".concat(t,"-empty-search-placeholder")}):O&&0===(null==Se?void 0:Se.length)?i.createElement(o.$J,{action:i.createElement(o.Qj,{onClick:Re},ge("extensions:develop.monitor.notifications.emptyFilterResult.actionLabel")),image:(0,c.jF)().emptySearch,imageSize:"tiny",title:ge("extensions:develop.monitor.notifications.emptyFilterResult.title"),subtitle:[ge("extensions:develop.monitor.notifications.emptyFilterResult.subtitle.0"),ge("extensions:develop.monitor.notifications.emptyFilterResult.subtitle.1")],"data-componentid":"".concat(t,"-empty-filter-placeholder")}):0!==(null==Se?void 0:Se.length)||be&&xe||Te?i.createElement(i.Fragment,null,Te&&V&&i.createElement("div",{className:"audit-logs-delay-message"},i.createElement(o.v0,{type:"info",compact:!0,content:ge("extensions:develop.monitor.filter.delayMessage.text")})),i.createElement(s.default,{handleScroll:Ce,scrollRef:he,logs:de,loading:Te,rowHeight:m.LogsConstants.LOG_ROW_HEIGHT,logCount:m.LogsConstants.LOG_FETCH_COUNT,isPreviousEmpty:v,isNextEmpty:y,logType:d.TabIndex.AUDIT_LOGS,setSearchQuery:Ne,"data-componentid":t})):i.createElement(o.$J,{image:(0,c.jF)().emptySearch,imageSize:"tiny",title:ge("extensions:develop.monitor.notifications.emptyResponse.title"),subtitle:[ge("extensions:develop.monitor.notifications.emptyResponse.subtitle.0")+"".concat(null===(e=m.LogsConstants.TIMERANGE_DROPDOWN_OPTIONS.find((function(e){return e.value===ie})))||void 0===e?void 0:e.text.toLowerCase()),ge("extensions:develop.monitor.notifications.emptyResponse.subtitle.1")],"data-componentid":"".concat(t,"-empty-data-placeholder")});var e},we=function(){if(O)return i.createElement(o.Qj,{basic:!0,compact:!0,primary:!1,"data-componentid":"".concat(t,"-clear-filter-button"),onClick:Re,disabled:!O},ge("extensions:develop.monitor.filter.topToolbar.buttons.clearFilters.label"))},Ge=function(){if(-1!==j){var e=(0,p.getDateTimeWithOffset)(ve);I(e.toString()),A((e-36e5*j).toString())}_e()},Ae=function(){var e=new Date(Number(te)).toISOString();return i.createElement("div",{className:"logs-refresh-component"},q&&i.createElement(o.kW,{icon:"warning sign",popup:!0,compact:!0,warning:!0},ge("extensions:develop.monitor.filter.refreshMessage.tooltipText")),i.createElement("p",null,q&&ge("extensions:develop.monitor.filter.refreshMessage.text")+(0,p.getTimeFromTimestamp)(e)))},Ue=function(e){return"requestId"===e?"traceId":e};return i.createElement("div",null,i.createElement("div",null,i.createElement("div",{className:"top-action-bar"},Fe(),i.createElement(u.default,{setFromTime:function(e){return A(e)},setToTime:function(e){return I(e)},setTimeRange:function(e){return D(e)},"data-componentid":"".concat(t,"-audit")}),le?i.createElement(o.KM,{onClick:function(){return Ge()},"data-componentid":"".concat(t,"-refresh-button")},i.createElement(r.Z,{name:"refresh"}),ge("extensions:develop.monitor.filter.refreshButton.label")):i.createElement(o.KM,{onClick:function(){return _e()},"data-componentid":"".concat(t,"-search-button")},i.createElement(r.Z,{name:"search"}),ge("extensions:develop.monitor.filter.queryButton.label"))),i.createElement("div",null,i.createElement("div",{className:"top-toolbar"},Ae(),i.createElement(l.Z.Group,null,null==$?void 0:$.map((function(e,t){return i.createElement(l.Z,{key:t,className:"filter-pill"},Ue(e.key),i.createElement(l.Z.Detail,null,e.value),i.createElement(r.Z,{name:"delete",onClick:function(){return ke(e.key)}}))})),we())),Ie())))};h.defaultProps={"data-componentid":"audit-logs"};const E=h}}]);