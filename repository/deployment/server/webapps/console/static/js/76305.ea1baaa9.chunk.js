"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[76305],{76305:(e,t,n)=>{n.r(t),n.d(t,{default:()=>U});var r=n(93129),s=n(3356),i=n(66112),a=n(86727),o=n(44194),l=n(10479),u=n(47245),c=n(62508),p=n(89141),d=n(35542),m=n(45481),f=n(24393),E=n(28897),g=n(37313),R=n(78645),S=n(15263),v=n(46556),_=n(8889);function h(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,s,i,a,o=[],l=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(r=i.call(n)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){u=!0,s=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw s}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}const U=function(e){var t=e["data-testid"],n=(0,l.$)().t,y=(0,u.I0)(),U=(0,u.v9)((function(e){return e.config.ui.features})),C=(0,u.v9)((function(e){var t;return null==e||null===(t=e.config)||void 0===t||null===(t=t.ui)||void 0===t?void 0:t.enableIdentityClaims})),A=h((0,i.cC)(),2),b=A[0],T=A[1],O=h((0,i.cC)(),2),I=O[0],N=O[1],M=h((0,o.useState)(null),2),D=M[0],L=M[1],P=h((0,o.useState)({description:"",name:""}),2),w=P[0],x=P[1],Y=h((0,o.useState)(_.RemoteUserStoreTypes.LDAP),2),k=Y[0],V=Y[1],Q=h((0,o.useState)(_.RemoteUserStoreAccessTypes.ReadOnly),2),j=Q[0],B=Q[1],Z=h((0,o.useState)(!1),2),$=Z[0],G=Z[1],H=h((0,o.useState)(!1),2),F=H[0],W=H[1],q=h((0,o.useState)(null),2),J=q[0],X=q[1];(0,o.useEffect)((function(){z(null,null,null,null,!C)}),[]),(0,o.useEffect)((function(){(0,E.E4)(_.RemoteUserStoreConstants.OUTBOUND_USER_STORE_TYPE_ID,null).then((function(e){L(e)}))}),[]);var z=function(e,t,i,a,o){W(!0);var l={"exclude-identity-claims":o,filter:a||null,limit:e||null,offset:i||null,sort:t||null};(0,d.WN)(l).then((function(e){X(e.filter((function(e){return e.claimURI===m.Q.USER_NAME_CLAIM_URI||e.claimURI===m.Q.USER_ID_CLAIM_URI})))})).catch((function(e){var t,i;y((0,s.V_)({description:(null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.description)||n("claims:local.notifications.getClaims.genericError.description"),level:r.QU.ERROR,message:(null==e||null===(i=e.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.message)||n("claims:local.notifications.getClaims.genericError.message")}))})).finally((function(){W(!1)}))},K=function(e){switch(e){case _.RemoteUserStoreConstants.PROPERTY_NAME_CONNECTED_USERSTORE_TYPE:return k.toString();case _.RemoteUserStoreConstants.PROPERTY_NAME_READ_ONLY:return j.toString()}},ee=function(e){if($){var t=[],i=function(){var e=[];return D.properties.Mandatory.map((function(t){e.push({name:t.name,value:K(t.name)})})),D.properties.Optional.map((function(t){e.push({name:t.name,value:t.defaultValue})})),e.push({name:_.RemoteUserStoreConstants.PROPERTY_NAME_READ_ONLY,value:K(_.RemoteUserStoreConstants.PROPERTY_NAME_READ_ONLY)}),e}();e.forEach((function(e,n){t.push({claimURI:n,mappedAttribute:e})}));var a,o={claimAttributeMappings:t,description:w.description,name:w.name,properties:i,typeId:_.RemoteUserStoreConstants.OUTBOUND_USER_STORE_TYPE_ID};a=o,(0,E.yS)(a).then((function(e){y((0,s.V_)({description:n("userstores:notifications.addUserstore.success.description"),level:r.QU.SUCCESS,message:n("userstores:notifications.addUserstore.success.message")})),y((0,s.V_)({description:n("userstores:notifications.delay.description"),level:r.QU.WARNING,message:n("userstores:notifications.delay.message")})),f.m8.push({pathname:f.$x.getPaths().get("USERSTORES_EDIT").replace(":id",e.id).replace("edit-user-store",R.userstoresConfig.userstoreEdit.remoteUserStoreEditPath)+"#tab=1",search:"?isNew=true"})})).catch((function(e){var t,i,a;403===(null===(t=e.response)||void 0===t?void 0:t.status)&&(null===(i=e.response.data)||void 0===i?void 0:i.code)===g.u4.ERROR_CREATE_LIMIT_REACHED.getErrorCode()&&y((0,s.V_)({description:n(g.u4.ERROR_CREATE_LIMIT_REACHED.getErrorDescription()),level:r.QU.ERROR,message:n(g.u4.ERROR_CREATE_LIMIT_REACHED.getErrorMessage())})),y((0,s.V_)({description:n("userstores:notifications.addUserstore.genericError.description"),level:r.QU.ERROR,message:null!==(a=null==e?void 0:e.message)&&void 0!==a?a:n("userstores:notifications.addUserstore.genericError.message")}))}))}},te=[{preventGoToNextStep:!$,stepAction:T,stepContent:o.createElement(v.GeneralUserStoreDetails,{triggerSubmit:b,featureConfig:U,handleBasicDetailsSubmit:function(e){x({description:e.get("description").toString(),name:e.get("name").toString()})},handleUserStoreTypeChange:function(e){V(e)},handleUserStoreAccessTypeChange:function(e){B(e)},setUserStoreNameValid:G}),stepTitle:n("extensions:manage.features.userStores.create.pageLayout.steps.generalSettings.title")},{stepAction:N,stepContent:o.createElement(o.Fragment,null,o.createElement(a.xv,{className:"section-description"},n("extensions:manage.features.userStores.create.pageLayout.steps.attributeMappings.subTitle")),o.createElement(c.Z,{hidden:!0}),o.createElement(v.AttributeMappingsComponent,{isAttributesListRequestLoading:F,triggerSubmit:I,mandatoryAttributes:J,handleAttributeMappingsSubmit:ee})),stepTitle:n("extensions:manage.features.userStores.create.pageLayout.steps.attributeMappings.title")}];return o.createElement(a.Xg,{title:n("extensions:manage.features.userStores.create.pageLayout.title"),contentTopMargin:!0,description:n("extensions:manage.features.userStores.create.pageLayout.description"),backButton:{"data-testid":"".concat(t,"-page-back-button"),onClick:function(){f.m8.push(f.$x.getPaths().get("USERSTORES"))},text:n("userstores:pageLayout.edit.back")},titleTextAlign:"left",bottomMargin:!1,showBottomDivider:!0,"data-testid":"".concat(t,"-page-layout")},o.createElement("div",{className:"remote-user-store-create-section"},o.createElement(a.pJ,{padded:"very"},o.createElement(p.Z,null,o.createElement(p.Z.Row,null,o.createElement(p.Z.Column,{width:10},o.createElement(S.VerticalStepper,{alwaysOpen:!1,isSidePanelOpen:!1,stepContent:te,isNextEnabled:!0,"data-testid":"".concat(t,"-vertical-stepper"),handleFinishAction:function(){return N()}})))))))}}}]);