"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[80943],{68734:(e,t,n)=>{n.d(t,{BZ:()=>h,Eb:()=>p,J4:()=>u,PF:()=>f,cQ:()=>d,dH:()=>m,tI:()=>E});var i=n(34148),o=n(67442),a=n(93129),s=n(73508),r=n(61263),c=n(14200),l=i.AsgardeoSPAClient.getInstance().httpRequest.bind(i.AsgardeoSPAClient.getInstance()),u=function(e){var t={headers:{Accept:"application/json","Content-Type":"application/json"},method:a.f2.GET,params:{filter:e},url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR)};return l(t).then((function(e){if(200===e.status)return Promise.resolve(e.data);throw new o.u(e.data.description,null,e.status,e.request,e,e.config)})).catch((function(e){var t;throw new o.u(e.message,e.stack,null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.code,e.request,e.response,e.config)}))},d=function(e,t,n){var i={headers:{Accept:"application/json","Content-Type":"application/json"},method:a.f2.GET,params:{after:e,before:t,filter:n},url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR)},o=(0,s.Z)(i),l=o.data,u=o.error;return{data:l,error:u,isLoading:!u&&!l,isValidating:o.isValidating,mutate:o.mutate}},p=function(e){var t={headers:{Accept:"application/json","Content-Type":"application/json"},method:a.f2.GET,url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR,"/").concat(e)},n=(0,s.Z)(e?t:null),i=n.data,o=n.error;return{data:i,error:o,isLoading:!o&&!i,isValidating:n.isValidating,mutate:n.mutate}},m=function(e){var t={headers:{Accept:"application/json","Content-Type":"application/json"},method:a.f2.GET,params:{filter:e},url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/permissions")};return l(t).then((function(e){if(200===e.status)return Promise.resolve(e.data);throw new o.u(e.data.description,null,e.status,e.request,e,e.config)})).catch((function(e){var t;throw new o.u(e.message,e.stack,null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.code,e.request,e.response,e.config)}))},f=function(e){var t={headers:{Accept:"application/json","Content-Type":"application/json"},method:a.f2.DELETE,url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR,"/")+"".concat(e)};return l(t).then((function(e){if(204!==e.status)throw new o.u(e.data.description,null,e.status,e.request,e,e.config);return Promise.resolve(e.data)})).catch((function(e){var t;throw new o.u(e.message,e.stack,null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.code,e.request,e.response,e.config)}))},h=function(e,t){var n={data:t,method:a.f2.PATCH,url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR,"/").concat(e)};return l(n).then((function(e){return Promise.resolve(e.data)})).catch((function(e){var t;throw new o.u(e.message,e.stack,null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.code,e.request,e.response,e.config)}))},E=function(e){var t={data:e,method:a.f2.POST,url:"".concat(r.h.getState().config.endpoints.authzEndpoint,"/").concat(c.K.API_RESOURCE_DIR)};return l(t).then((function(e){return Promise.resolve(e.data)})).catch((function(e){var t;throw new o.u(e.message,e.stack,null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.code,e.request,e.response,e.config)}))}},7553:(e,t,n)=>{n.d(t,{BZ:()=>i.BZ,Eb:()=>i.Eb,J4:()=>i.J4,PF:()=>i.PF,cQ:()=>i.cQ,dH:()=>i.dH,tI:()=>i.tI});var i=n(68734)},80943:(e,t,n)=>{n.r(t),n.d(t,{AuthorizeAPIResource:()=>S});var i=n(95817),o=n(93129),a=n(3356),s=n(66112),r=n(86727),c=n(44194),l=n(10479),u=n(47245),d=n(12638),p=n(47018),m=n(89141),f=n(33040),h=n(7553),E=n(14200),v=n(157);function b(e){return function(e){if(Array.isArray(e))return z(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||A(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,o,a,s,r=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(i=a.call(n)).done)&&(r.push(i.value),r.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(l)throw o}}return r}}(e,t)||A(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var S=function(e){var t=e.subscribedAPIResourcesListData,n=e.closeWizard,A=e.handleCreateAPIResource,z=e["data-componentid"],S=(0,l.$)().t,y=(0,u.I0)(),R=(0,r.fQ)().getLink,w=g((0,s.cC)(),2),I=w[0],P=w[1],C=(0,u.v9)((function(e){return e.config.ui.productName})),x=g((0,c.useState)([]),2),Z=x[0],k=x[1],N=g((0,c.useState)(!1),2),O=N[0],_=N[1],j=g((0,c.useState)(!1),2),T=j[0],q=j[1],D=g((0,c.useState)(null),2),L=D[0],K=D[1],U=g((0,c.useState)(null),2),F=U[0],Q=U[1],H=g((0,c.useState)(!0),2),M=H[0],G=H[1],V=g((0,c.useState)([]),2),B=V[0],J=V[1],W=g((0,c.useState)([]),2),$=W[0],X=W[1],Y=g((0,c.useState)([]),2),ee=Y[0],te=Y[1],ne=g((0,c.useState)(!1),2),ie=ne[0],oe=ne[1],ae=g((0,c.useState)([]),2),se=ae[0],re=ae[1],ce=g((0,c.useState)(!1),2),le=ce[0],ue=ce[1],de=g((0,c.useState)(v.Policy.ROLE),2),pe=de[0],me=de[1],fe=g((0,c.useState)(!1),2),he=fe[0],Ee=fe[1],ve=g((0,c.useState)(!0),2),be=ve[0],ge=ve[1],Ae=(0,h.cQ)(L),ze=Ae.data,Se=Ae.isLoading,ye=Ae.error,Re=Ae.mutate;(0,c.useEffect)((function(){ye&&(y((0,a.V_)({description:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.createAuthorizedAPIResource.initialError.description"),level:o.QU.ERROR,message:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.createAuthorizedAPIResource.initialError.message")})),n())}),[ye]),(0,c.useEffect)((function(){var e;if(T||q(!0),ze){var n,i=null==ze?void 0:ze.apiResources.reduce((function(e,n){0!==(null==t?void 0:t.length)&&(null!=t&&t.some((function(e){return e.apiIdentifier===n.identifier})))||(0===$.length||!(null!=$&&$.some((function(e){return e.key===n.id}))))&&e.push({key:n.id,text:n.displayName,value:n.id});return e}),[]);X([].concat(b($),b(i||[]))),k([].concat(b(Z),b(ze.apiResources)));var o=!1;null==ze||null===(n=ze.links)||void 0===n||n.forEach((function(t){t.rel===E.K.AFTER_REL&&(e=t.href.split("".concat(E.K.AFTER_REL,"="))[1])!==L&&(K(e),o=!0)})),o?Re():q(!1)}}),[ze]),(0,c.useEffect)((function(){oe(!0),F&&(te(null==F?void 0:F.permissions.map((function(e){return{content:c.createElement(d.Z,{as:"h6",className:"header-with-icon"},c.createElement(d.Z.Content,null,e.displayName,c.createElement(d.Z.Subheader,null,c.createElement(r.EK,{withBackground:!0},e.name)))),key:e.name,text:e.displayName,value:e.name}}))),J([])),oe(!1)}),[F]),(0,c.useEffect)((function(){ue(!0);var e=[];v.policyDetails.forEach((function(t,n){e.push({key:n,text:t.name(),value:t.policyIdentifier()})})),re(e),ue(!1)}),[]),(0,c.useEffect)((function(){F&&G(F.requiresAuthorization)}),[F]),(0,c.useEffect)((function(){Ee((null==F?void 0:F.permissions.length)===(null==B?void 0:B.length))}),[F,B]),(0,c.useEffect)((function(){ge(0===(null==B?void 0:B.length))}),[B]);var we=function(e){J(e?[]:null==F?void 0:F.permissions.map((function(e){return e.name})))},Ie=function(){_(!1),X([])};return c.createElement(p.Z,{"data-testid":z,open:!0,className:"wizard api-resource-create-wizard",dimmer:"blurring",size:"small",onClose:n,closeOnDimmerClick:!1,closeOnEscape:!0},c.createElement(p.Z.Header,{className:"wizard-header"},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.title"),c.createElement(r.X6,{as:"h6"},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.subTitle"))),c.createElement(p.Z.Content,{className:"content-container",scrolling:!0},Se||T?c.createElement(r.pO,{inline:"centered",active:!0}):c.createElement(s.Es,{"data-componentid":"".concat(z,"-form"),uncontrolledForm:!1,onChange:function(e,t){var n=t.get("apiResource").toString(),i=t.get("policy").toString();if(n!==(null==F?void 0:F.id)){var o=null==Z?void 0:Z.find((function(e){return e.id===n}));Q(o),o.requiresAuthorization&&(t.set("policy",v.Policy.ROLE),me(v.Policy.ROLE))}i!==pe&&me(i)},onSubmit:function(){_(!0),A(F.id,B,pe.toString(),Ie)},submitState:I},c.createElement(m.Z,null,c.createElement(m.Z.Row,{columns:1},c.createElement(m.Z.Column,{mobile:16,tablet:16,computer:12},c.createElement(s.gN,{"data-componentid":"".concat(z,"-api"),label:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.apiResource.label"),placeholder:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.apiResource.placeholder"),type:"dropdown",name:"apiResource",key:"apiResource",children:$,tabIndex:3,required:!0,requiredErrorMessage:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.apiResource.requiredErrorMessage"),search:!0,selection:!0,scrolling:!0}))),c.createElement(m.Z.Row,{columns:1},c.createElement(m.Z.Column,{mobile:16,tablet:16,computer:12},c.createElement(m.Z,null,c.createElement(m.Z.Row,{columns:2},c.createElement(m.Z.Column,{className:"pb-1",floated:"left",stretched:!0,verticalAlign:"bottom"},c.createElement("label",null,c.createElement(r.xv,{size:13,className:"mb-1",muted:!F},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.scopes.label")))),c.createElement(m.Z.Column,{floated:"right",textAlign:"right"},c.createElement(r.xv,{className:"mb-0",muted:!0,subHeading:!0,size:12},c.createElement(i.Z,{variant:"text",size:"small",disabled:!F||he,onClick:function(){return we(!1)}},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.selectAll")),"|",c.createElement(i.Z,{variant:"text",size:"small",disabled:!F||be,onClick:function(){return we(!0)}},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.selectNone")))))),c.createElement(f.Z,{className:"mb-3","data-componentid":"".concat(z,"-scopes"),placeholder:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.scopes.placeholder"),fluid:!0,multiple:!0,search:!0,selection:!0,required:!0,value:B,onChange:function(e,t){var n=t.value;J(t.options.filter((function(e){if(n.includes(e.value.toString()))return e})).map((function(e){return e.value.toString()})))},loading:ie,options:ee,disabled:!F}),c.createElement(r.kW,{disabled:!F},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.scopes.hint")))),c.createElement(m.Z.Row,{columns:1,className:"pt-2"},c.createElement(m.Z.Column,{mobile:16,tablet:16,computer:12},c.createElement(r.GI,{content:S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.rbacPolicyMessage",{productName:C}),disabled:!F||!M,inverted:!0,trigger:c.createElement("label",null,c.createElement(r.xv,{size:13,className:"mb-1",muted:!F||M},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.policy.label")))}),c.createElement(s.gN,{"data-componentid":"".concat(z,"-policy"),type:"dropdown",name:"policy",key:"policy",children:se,tabIndex:4,default:v.policyDetails.get(v.Policy.ROLE).policyIdentifier(),loading:le,disabled:!F||M,search:!0,selection:!0,scrolling:!0}),c.createElement(r.kW,{className:"mb-1",disabled:!F||M},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.fields.policy.hint")))),F&&c.createElement(m.Z.Row,{columns:1,className:"pt-0"},c.createElement(m.Z.Column,{mobile:16,tablet:16,computer:12},c.createElement(r.v0,{type:"info",header:v.policyDetails.get(pe).name(),content:c.createElement(c.Fragment,null,v.policyDetails.get(pe).hint(),c.createElement(r.eb,{link:R(v.policyDetails.get(pe).documentationLink())},S("extensions:common.learnMore")))})))))),c.createElement(p.Z.Actions,null,c.createElement(m.Z,null,c.createElement(m.Z.Row,{column:1},c.createElement(m.Z.Column,{mobile:8,tablet:8,computer:8},c.createElement(r.Qj,{tabIndex:5,"data-testid":"".concat(z,"-cancel-button"),floated:"left",onClick:n,disabled:O},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.buttons.cancel"))),c.createElement(m.Z.Column,{mobile:8,tablet:8,computer:8},c.createElement(r.KM,{tabIndex:6,"data-testid":"".concat(z,"-finish-button"),floated:"right",onClick:P,loading:O},S("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.wizards.authorizeAPIResource.buttons.finish")))))))};S.defaultProps={"data-componentid":"authorize-api-resource"}}}]);