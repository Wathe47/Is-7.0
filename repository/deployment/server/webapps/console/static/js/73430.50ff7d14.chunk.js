"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[73430],{73430:(e,t,n)=>{n.r(t),n.d(t,{GroupUsersList:()=>C});var r=n(54833),l=n(93129),a=n(3356),i=n(86727),s=n(39345),o=n(67127),u=n(44194),c=n(10479),d=n(47245),m=n(66528),p=n(26154),f=n(47018),v=n(89141),h=n(12638),g=n(62508),E=n(24393),y=n(12430),S=n(28713),b=n(31659),R=n(61145);function w(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=I(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function U(e){return function(e){if(Array.isArray(e))return L(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||I(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,l,a,i,s=[],o=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;o=!1}else for(;!(o=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);o=!0);}catch(e){u=!0,l=e}finally{try{if(!o&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(u)throw l}}return s}}(e,t)||I(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var C=function(e){var t=e.isReadOnly,n=e.group,I=e.onGroupUpdate,L=e.isGroupDetailsRequestLoading,C=e["data-testid"],Z=(0,c.$)().t,O=(0,d.I0)(),_=P((0,i.IK)(),3),N=_[0],A=_[1],T=_[2],x=P((0,u.useState)([]),2),k=x[0],z=x[1],j=P((0,u.useState)([]),2),G=j[0],M=j[1],Q=P((0,u.useState)([]),2),F=Q[0],D=Q[1],H=P((0,u.useState)(!1),2)[1],V=P((0,u.useState)(!1),2),J=V[0],X=V[1],q=P((0,u.useState)(!0),2),B=q[0],W=q[1],K=P((0,u.useState)(!0),2),$=K[0],Y=K[1],ee=P((0,u.useState)(!1),2),te=ee[0],ne=ee[1],re=P((0,u.useState)(0),2),le=re[0],ae=re[1],ie=P((0,u.useState)(0),2),se=ie[0],oe=ie[1],ue=P((0,u.useState)(!0),2),ce=ue[0],de=ue[1],me=P((0,u.useState)(!0),2),pe=me[0],fe=me[1],ve=P((0,u.useState)(""),2),he=ve[0],ge=ve[1],Ee=P((0,u.useState)(""),2),ye=Ee[0],Se=Ee[1],be=P((0,u.useState)([]),2),Re=be[0],we=be[1],Ue=P((0,u.useState)([]),2),Pe=Ue[0],Ie=Ue[1],Le=E.ru.DEFAULT_RESOURCE_LIST_ITEM_LIMIT+1,Ce=function(e){return e[e.GROUP_USERS=0]="GROUP_USERS",e[e.ALL_USERS=1]="ALL_USERS",e}({});(0,u.useEffect)((function(){Oe()}),[n,le,he]),(0,u.useEffect)((function(){Ze()}),[se,J,ye]);var Ze=function(){var e,t,r=-1===(null==n||null===(e=n.displayName)||void 0===e?void 0:e.indexOf("/"))?"primary":null==n||null===(t=n.displayName)||void 0===t?void 0:t.split("/")[0],i=(null==ye?void 0:ye.length)>0?ye:null;return Y(!0),(0,S.Fp)(Le,se,i,null,r).then((function(e){var t,n=_e(null==e?void 0:e.Resources,Le,Ce.ALL_USERS);n=null==e||null===(t=e.Resources)||void 0===t?void 0:t.filter((function(e){var t;return!(null!==(t=e[R.SCIMConfigs.scim.enterpriseSchema])&&void 0!==t&&t.userSourceId)})),z(n),D(n)})).catch((function(e){var t,n,r,i,s,o,u;null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(t=t.data)&&void 0!==t&&t.description?O((0,a.V_)({description:null!==(n=null!==(r=null==e||null===(i=e.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.description)&&void 0!==r?r:null==e||null===(s=e.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)&&void 0!==n?n:Z("users:notifications.fetchUsers.error.description"),level:l.QU.ERROR,message:null!==(o=null==e||null===(u=e.response)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.message)&&void 0!==o?o:Z("users:notifications.fetchUsers.error.message")})):(O((0,a.V_)({description:Z("users:notifications.fetchUsers.genericError.description"),level:l.QU.ERROR,message:Z("users:notifications.fetchUsers.genericError.message")})),z([]),D([]))})).finally((function(){Y(!1)}))},Oe=function(){var e,t,r,i=-1===(null==n||null===(e=n.displayName)||void 0===e?void 0:e.indexOf("/"))?"primary":null==n||null===(t=n.displayName)||void 0===t?void 0:t.split("/")[0],s="groups eq "+(null==n||null===(r=n.displayName)||void 0===r?void 0:r.split("/")[1]);(null==he?void 0:he.length)>0&&(s=s+" and "+he),W(!0),(0,S.Fp)(Le,le,s,null,i).then((function(e){var t,n=_e(null==e?void 0:e.Resources,Le,Ce.GROUP_USERS);n=null===(t=n)||void 0===t?void 0:t.filter((function(e){var t;return!(null!==(t=e[R.SCIMConfigs.scim.enterpriseSchema])&&void 0!==t&&t.userSourceId)})),M(n)})).catch((function(e){var t,n,r,i,s,o,u;null!=e&&null!==(t=e.response)&&void 0!==t&&null!==(t=t.data)&&void 0!==t&&t.description?O((0,a.V_)({description:null!==(n=null!==(r=null==e||null===(i=e.response)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.description)&&void 0!==r?r:null==e||null===(s=e.response)||void 0===s||null===(s=s.data)||void 0===s?void 0:s.detail)&&void 0!==n?n:Z("users:notifications.fetchUsers.error.description"),level:l.QU.ERROR,message:null!==(o=null==e||null===(u=e.response)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.message)&&void 0!==o?o:Z("users:notifications.fetchUsers.error.message")})):(O((0,a.V_)({description:Z("users:notifications.fetchUsers.genericError.description"),level:l.QU.ERROR,message:Z("users:notifications.fetchUsers.genericError.message")})),M([]))})).finally((function(){W(!1)}))},_e=function(e,t,n){return(null==e?void 0:e.length)<t?n===Ce.GROUP_USERS?de(!1):fe(!1):(null==e||e.splice(-1,1),n===Ce.GROUP_USERS?de(!0):fe(!0)),e},Ne=function(e,t){oe((t.activePage-1)*E.ru.DEFAULT_RESOURCE_LIST_ITEM_LIMIT+1)},Ae=function(e){var t,r,l,a="",i=!1;-1!=(null==n||null===(t=n.displayName)||void 0===t?void 0:t.indexOf("/"))&&(a=null==n||null===(r=n.displayName)||void 0===r?void 0:r.split("/")[1],null===(l=e.groups)||void 0===l||l.map((function(e){var t,n;-1!=(null===(t=e.display)||void 0===t?void 0:t.indexOf("/"))&&(null===(n=e.display)||void 0===n?void 0:n.split("/")[1])===a&&(i=!0)})));return i},Te=function(e){return Ae(e)?!Pe.some((function(t){return t.id===e.id})):!!Re.some((function(t){return t.id===e.id}))},xe=function(){Ze().then((function(){H((null==G?void 0:G.length)===(null==k?void 0:k.length)),X(!0)})).catch((function(){O((0,a.V_)({description:Z("users:notifications.fetchUsers.genericError.description"),level:l.QU.ERROR,message:Z("users:notifications.fetchUsers.genericError.message")}))}))},ke=function(){D(k),oe(0),H(!1),X(!1)},ze=function(){var e,t=[],r=w(Re);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.push({display:i.userName,value:i.id})}}catch(d){r.e(d)}finally{r.f()}var s,o={Operations:[{op:"add",value:{members:t}}],schemas:["urn:ietf:params:scim:api:messages:2.0:PatchOp"]},u=w(Pe);try{for(u.s();!(s=u.n()).done;){var c=s.value;o.Operations.push({op:"remove",path:"members[display eq "+c.userName+"]"})}}catch(d){u.e(d)}finally{u.f()}ne(!0),(0,y.fF)(n.id,o).then((function(){O((0,a.V_)({description:Z("console:manage.features.groups.notifications.updateGroup.success.description"),level:l.QU.SUCCESS,message:Z("console:manage.features.groups.notifications.updateGroup.success.message")})),I(n.id)})).catch((function(){A({description:Z("console:manage.features.groups.notifications.updateGroup.error.description"),level:l.QU.ERROR,message:Z("console:manage.features.groups.notifications.updateGroup.error.message")})})).finally((function(){ne(!1)}))},je=function(e){J?(oe(0),Se(e)):ge(e)},Ge=function(){J?(oe(0),Se("")):ge("")},Me=function(){return u.createElement(E.nC,{"data-testid":"".concat(C,"-user-list-advanced-search"),style:{maxHeight:20},onFilter:je,filterAttributeOptions:[{key:0,text:Z("users:advancedSearch.form.dropdown.filterAttributeOptions.username"),value:"userName"},{key:1,text:Z("users:advancedSearch.form.dropdown.filterAttributeOptions.email"),value:"emails"},{key:2,text:"First Name",value:"name.givenName"},{key:3,text:"Last Name",value:"name.familyName"}],filterAttributePlaceholder:Z("users:advancedSearch.form.inputs.filterAttribute.placeholder"),filterConditionsPlaceholder:Z("users:advancedSearch.form.inputs.filterCondition.placeholder"),filterValuePlaceholder:Z("users:advancedSearch.form.inputs.filterValue.placeholder"),placeholder:Z("users:advancedSearch.placeholder"),defaultSearchAttribute:"emails",defaultSearchOperator:"co"})},Qe=function(e){var t,n,l=(0,r.WX)(null==e?void 0:e.userName),a=b.QH.resolveUserListSubheader(e),s=void 0===(null===(t=e.name)||void 0===t?void 0:t.familyName)&&void 0===(null===(n=e.name)||void 0===n?void 0:n.givenName);return u.createElement(m.Z.Row,{key:e.id},u.createElement(m.Z.Cell,null,u.createElement(h.Z,{image:!0,as:"h6",className:"header-with-icon","data-testid":"".concat(C,"-item-heading")},u.createElement(i.Yt,{"data-testid":"".concat(C,"-users-list-").concat(e.userName,"-avatar"),name:l,spaced:"right",size:"mini",floated:"left",image:e.profileUrl,"data-hj-suppress":""}),u.createElement(h.Z.Content,null,u.createElement("div",{className:s?"mt-2":"","data-hj-suppress":""},l),!s&&u.createElement(h.Z.Subheader,{"data-testid":"".concat(C,"-item-sub-heading")},a)))))};return u.createElement(i.pJ,{padded:"very"},u.createElement(i.X6,{as:"h4"},Z("extensions:manage.groups.edit.users.heading")),u.createElement(i.X6,{subHeading:!0,ellipsis:!0,as:"h6"},Z("extensions:manage.groups.edit.users.description")),u.createElement(g.Z,{hidden:!0}),u.createElement(v.Z,null,(null==G?void 0:G.length)>0||(null==he?void 0:he.length)>0?u.createElement(v.Z.Row,{columns:2},u.createElement(v.Z.Column,{width:13},u.createElement(i.pJ,{"data-testid":"group-mgt-users-list-se",className:"user-role-edit-header-segment-se"},Me())),u.createElement(v.Z.Column,{width:3},!t&&u.createElement(i.zx,{"data-testid":"".concat(C,"-users-list-edit-button"),size:"large",icon:"pencil",floated:"right",onClick:xe}))):null,u.createElement(v.Z.Row,null,u.createElement(v.Z.Column,{computer:16},u.createElement(v.Z.Row,null,u.createElement(v.Z.Column,{mobile:16,tablet:16,computer:12},u.createElement(i.PS,{showTopActionPanel:!1,currentListSize:null==G?void 0:G.length,listItemLimit:Le,onItemsPerPageDropdownChange:null,"data-componentid":"group-mgt-user-list-layout","data-testid":"group-mgt-user-list-layout",onPageChange:function(e,t){ae((t.activePage-1)*E.ru.DEFAULT_RESOURCE_LIST_ITEM_LIMIT+1)},showPagination:(null==G?void 0:G.length)>0,totalPages:100,totalListSize:null==G?void 0:G.length,isLoading:B||L,paginationOptions:{disableNextButton:!ce,showItemsPerPageDropdown:!1},showPaginationPageLimit:!1},(null==G?void 0:G.length)>0?u.createElement(m.Z,{singleLine:!0,compact:!0},u.createElement(m.Z.Header,null,u.createElement(m.Z.Row,null,u.createElement(m.Z.HeaderCell,null,u.createElement("strong",null,Z("user:updateUser.groups.editGroups.groupList.headers.1"))))),u.createElement(m.Z.Body,null,null==G?void 0:G.map((function(e){return Qe(e)})))):he.length>0?u.createElement(i.$J,{action:u.createElement(i.Qj,{onClick:Ge},Z("users:usersList.search.emptyResultPlaceholder.clearButton")),image:(0,E.jF)().emptySearch,imageSize:"tiny",title:Z("users:usersList.search.emptyResultPlaceholder.title"),subtitle:[Z("users:usersList.search.emptyResultPlaceholder.subTitle.0",{query:he}),Z("users:usersList.search.emptyResultPlaceholder.subTitle.1")]}):u.createElement(i.$J,{title:Z("roles:edit.users.list.emptyPlaceholder.title"),subtitle:[Z("roles:edit.users.list.emptyPlaceholder.subtitles",{type:"group"})],action:!t&&u.createElement(i.KM,{"data-testid":"".concat(C,"-users-list-empty-assign-users-button"),onClick:xe},u.createElement(p.Z,{name:"plus"}),Z("roles:edit.users.list.emptyPlaceholder.action")),image:(0,E.jF)().emptyList,imageSize:"tiny"})))),u.createElement(v.Z.Row,null,u.createElement(v.Z.Column,{mobile:16,tablet:16,computer:12},u.createElement(g.Z,{hidden:!0})),u.createElement(v.Z.Column,{mobile:16,tablet:16,computer:12},u.createElement(g.Z,{hidden:!0}))),u.createElement(f.Z,{"data-testid":"".concat(C,"-assign-user-wizard-modal"),dimmer:"blurring",open:J,size:"small",className:"user-roles"},u.createElement(f.Z.Header,null,Z("roles:addRoleWizard.users.assignUserModal.heading",{type:"Group"}),u.createElement(i.X6,{subHeading:!0,ellipsis:!0,as:"h6"},Z("roles:addRoleWizard.users.assignUserModal.subHeading",{type:"group"}))),u.createElement(f.Z.Content,null,N&&T,u.createElement(v.Z,null,u.createElement(v.Z.Row,null,u.createElement(v.Z.Column,{width:16},u.createElement(i.pJ,null,Me()))),u.createElement(v.Z.Row,null,u.createElement(v.Z.Column,{width:16},u.createElement(i.PS,{showTopActionPanel:!1,currentListSize:null==F?void 0:F.length,listItemLimit:Le,onItemsPerPageDropdownChange:null,"data-componentid":"group-mgt-user-list-layout","data-testid":"group-mgt-user-list-layout",onPageChange:Ne,showPagination:!0,totalPages:100,totalListSize:null==k?void 0:k.length,isLoading:$,paginationOptions:{disableNextButton:!pe,showItemsPerPageDropdown:!1},showPaginationPageLimit:!1},u.createElement(i.IX,{compact:!0,basic:!0,bordered:!0,className:"group-add-user-model-transfer-list",selectionComponent:!0,searchPlaceholder:Z("roles:addRoleWizard.users.assignUserModal.list.searchPlaceholder"),isLoading:$,showListSearch:!1,handleUnelectedListSearch:function(e,t){!function(e,t,n,r){var l=[];if(!(0,o.Z)(t)){var a=new RegExp((0,s.Z)(t),"i");return n&&n.map((function(e){(a.test(e.userName)||e.name&&a.test(e.name.givenName)||e.name&&a.test(e.name.familyName))&&l.push(e)})),void r(l)}r(n)}(0,t.value,k,D)},"data-testid":"".concat(C,"-user-list-transfer")},u.createElement(i.Jv,{selectionComponent:!0,isListEmpty:!((null==k?void 0:k.length)>0),isLoading:$,listType:"unselected","data-testid":"".concat(C,"-unselected-transfer-list"),emptyPlaceholderContent:Z("transferList:list.emptyPlaceholders.groups.common",{type:"users"}),emptyPlaceholderDefaultContent:Z("transferList:list.emptyPlaceholders.default")},null==k?void 0:k.map((function(e,t){var n,l=(0,r.WX)(null==e?void 0:e.userName),a=b.QH.resolveUserListSubheader(e);return u.createElement(i.qT,{handleItemChange:function(){return function(e){var t=(0,o.Z)(Re)?[]:U(Re),n=(0,o.Z)(Pe)?[]:U(Pe);Ae(e)?n.some((function(t){return t.id===e.id}))?(n.splice(n.findIndex((function(t){return t.id===e.id})),1),Ie(n)):(n.push(e),Ie(n)):t.some((function(t){return t.id===e.id}))?(t.splice(t.findIndex((function(t){return t.id===e.id})),1),we(t)):(t.push(e),we(t))}(e)},key:t,listItem:{listItemElement:(n=l,u.createElement("div",{"data-hj-suppress":""},n)),listItemValue:a},listItemId:e.id,listItemIndex:t,isItemChecked:Te(e),showSecondaryActions:!1,showListSubItem:!0,listSubItem:l!==a&&u.createElement(i.EK,{compact:!0,withBackground:!1},a),"data-testid":"".concat(C,"-unselected-transfer-list-item-").concat(t)})}))))))))),u.createElement(f.Z.Actions,null,u.createElement(v.Z,null,u.createElement(v.Z.Row,{columns:2},u.createElement(v.Z.Column,{mobile:8,tablet:8,computer:8},u.createElement(i.Qj,{"data-testid":"".concat(C,"-assign-user-wizard-modal-cancel-button"),onClick:ke,floated:"left"},Z("common:cancel"))),u.createElement(v.Z.Column,{mobile:8,tablet:8,computer:8},u.createElement(i.KM,{"data-testid":"".concat(C,"-assign-user-wizard-modal-save-button"),onClick:function(){ze(),X(!1)},floated:"right",loading:te,disabled:te},Z("common:save")))))))))))}}}]);