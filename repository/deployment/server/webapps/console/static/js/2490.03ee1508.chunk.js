"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[2490,61793,51978,98258],{61793:(e,t,n)=>{n.r(t),n.d(t,{disconnectAgentConnection:()=>o.disconnectAgentConnection,generateToken:()=>o.generateToken,getAgentConnections:()=>o.getAgentConnections,regenerateToken:()=>o.regenerateToken});var o=n(51978)},51978:(e,t,n)=>{n.r(t),n.d(t,{disconnectAgentConnection:()=>l,generateToken:()=>u,getAgentConnections:()=>c,regenerateToken:()=>d});var o=n(34148),r=n(93129),a=n(24393),i="Resource not found.",s=o.AsgardeoSPAClient.getInstance().httpRequest.bind(o.AsgardeoSPAClient.getInstance()),c=function(e){var t={headers:{Accept:"application/json","Access-Control-Allow-Origin":a.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:r.f2.GET,url:"".concat(a.h.getState().config.endpoints.userStoreAgentConnection,"/").concat(e)};return s(t).then((function(e){return 200!==e.status?Promise.reject("An error occurred. The server returned ".concat(e.status)):Promise.resolve(e.data)})).catch((function(e){var t,n;if((null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)!==i)return Promise.reject(null==e||null===(n=e.response)||void 0===n?void 0:n.data)}))},l=function(e,t){var n={headers:{Accept:"application/json","Access-Control-Allow-Origin":a.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:r.f2.DELETE,url:"".concat(a.h.getState().config.endpoints.userStoreAgentConnection,"/").concat(e,"/agent/").concat(t)};return s(n).then((function(e){return 204!==e.status?Promise.reject("An error occurred. The server returned ".concat(e.status)):Promise.resolve(e.data)})).catch((function(e){var t,n;if((null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)!==i)return Promise.reject(null==e||null===(n=e.response)||void 0===n?void 0:n.data)}))},u=function(e){var t={data:e,headers:{Accept:"application/json","Access-Control-Allow-Origin":a.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:r.f2.POST,url:"".concat(a.h.getState().config.endpoints.userStoreAgentToken)};return s(t).then((function(e){return 200!==e.status?Promise.reject("An error occurred. The server returned ".concat(e.status)):Promise.resolve(e.data)})).catch((function(e){var t,n;if((null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)!==i)return Promise.reject(null==e||null===(n=e.response)||void 0===n?void 0:n.data)}))},d=function(e){var t={data:e,headers:{Accept:"application/json","Access-Control-Allow-Origin":a.h.getState().config.deployment.clientHost,"Content-Type":"application/json"},method:r.f2.POST,url:"".concat(a.h.getState().config.endpoints.userStoreAgentToken,"/regenerate")};return s(t).then((function(e){return 200!==e.status?Promise.reject("An error occurred. The server returned ".concat(e.status)):Promise.resolve(e.data)})).catch((function(e){var t,n;if((null==e||null===(t=e.response)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.message)!==i)return Promise.reject(null==e||null===(n=e.response)||void 0===n?void 0:n.data)}))}},2490:(e,t,n)=>{n.r(t),n.d(t,{UserStoreGeneralSettings:()=>C});var o=n(93129),r=n(3356),a=n(66112),i=n(86727),s=n(44194),c=n(10479),l=n(47245),u=n(26154),d=n(89141),m=n(62508),g=n(19980),f=n(73432),p=n(10909),h=n(24393),v=n(28897),E=n(37313),y=n(61793);function A(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,a,i,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=a.call(n)).done)&&(s.push(o.value),s.length!==t);c=!0);}catch(e){l=!0,r=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw r}}return s}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var C=function(e){var t,n,S,C=e.isDisabled,b=e.userStore,k=e.userStoreId,w=e.handleUserStoreDisabled,Z=e.userStoreProperties,T=e["data-testid"],U=(0,c.$)().t,N=(0,l.I0)(),V=(0,i.fQ)().getLink,P=(0,i.kH)().isMobileViewport,R=A((0,s.useState)([]),2),I=R[0],O=R[1],j=A((0,s.useState)(null),2),H=j[0],M=j[1],x=A((0,s.useState)(""),2),D=x[0],_=x[1],Q=A((0,s.useState)(""),2),q=Q[0],G=Q[1],L=A((0,s.useState)(""),2),z=L[0],Y=L[1],$=A((0,s.useState)(!1),2),W=$[0],X=$[1],J=A((0,s.useState)(!1),2),K=J[0],F=J[1],B=A((0,s.useState)(!1),2),ee=B[0],te=B[1],ne=A((0,s.useState)(null),2),oe=ne[0],re=ne[1],ae=A((0,s.useState)(null),2),ie=ae[0],se=ae[1],ce=A((0,s.useState)(!1),2),le=ce[0],ue=ce[1],de=A((0,s.useState)(!1),2),me=de[0],ge=de[1],fe=A((0,s.useState)(!1),2),pe=fe[0],he=fe[1],ve=A((0,s.useState)(!1),2),Ee=ve[0],ye=ve[1],Ae=A((0,s.useState)(!1),2),Se=Ae[0],Ce=Ae[1],be=A((0,s.useState)(!1),2),ke=be[0],we=be[1],Ze=A((0,i.ZK)(),3),Te=Ze[0],Ue=Ze[1],Ne=Ze[2],Ve=(0,l.v9)((function(e){return e.auth.isPrivilegedUser}));(0,s.useEffect)((function(){we(!0),(0,y.getAgentConnections)(k).then((function(e){O(e.filter((function(e){return null==e?void 0:e.agent})))})).finally((function(){we(!1)}))}),[k]),(0,s.useEffect)((function(){(W||K)&&Pe()}),[ie]),(0,s.useEffect)((function(){z&&te(!0)}),[z]),(0,s.useEffect)((function(){D&&X(!0)}),[D]),(0,s.useEffect)((function(){q&&F(!0)}),[q]);var Pe=function(){we(!0),(0,y.getAgentConnections)(k).then((function(e){O(e.filter((function(e){return null==e?void 0:e.agent})))})).finally((function(){we(!1)}))};return s.createElement(s.Fragment,null,ke?s.createElement(i.pO,null):s.createElement(i.pJ,{padded:"very"},s.createElement(d.Z,null,s.createElement(d.Z.Row,null,s.createElement(d.Z.Column,{width:6},s.createElement(a.Es,{onSubmit:function(e){!function(e){var t={operation:"REPLACE",path:"/description",value:e.get("description").toString()};(0,v.Xv)(k,[t]).then((function(){N((0,r.V_)({description:U("userstores:notifications.updateUserstore.success.description"),level:o.QU.SUCCESS,message:U("userstores:notifications.updateUserstore.success.message")})),N((0,r.V_)({description:U("userstores:notifications.updateDelay.description"),level:o.QU.WARNING,message:U("userstores:notifications.updateDelay.message")}))})).catch((function(e){N((0,r.V_)({description:(null==e?void 0:e.description)||U("userstores:notifications.updateUserstore.genericError.description"),level:o.QU.ERROR,message:(null==e?void 0:e.message)||U("userstores:notifications.updateUserstore.genericError.message")}))}))}(e)}},s.createElement(a.gN,{requiredErrorMessage:null,type:"text",name:"description",label:"Description",required:!1,placeholder:"Enter the description of the user store",maxLength:300,minLength:3,width:14,"data-testid":"".concat(T,"-user-store-description-textarea"),value:null!=b&&b.description?null==b?void 0:b.description:""}),s.createElement(i.GI,{trigger:s.createElement("div",{className:P?"mb-1x mt-1x inline-button button-width":"inline-button"},s.createElement(i.KM,{type:"submit",disabled:!("false"===(null==b||null===(t=b.properties)||void 0===t||null===(t=t.find((function(e){return e.name===E.rr})))||void 0===t?void 0:t.value))},U("common:update"))),content:U("extensions:manage.features.userStores.edit.general.disable.buttonDisableHint"),size:"mini",wide:!0,disabled:!("false"!==(null==b||null===(n=b.properties)||void 0===n||null===(n=n.find((function(e){return e.name===E.rr})))||void 0===n?void 0:n.value))}))))),s.createElement(m.Z,{hidden:!0}),s.createElement(m.Z,null),s.createElement(m.Z,{hidden:!0}),s.createElement(i.X6,{as:"h4"},"User Store Agent Connection(s)"),s.createElement(g.Z,{className:"agent-connections-section",padded:"very"},s.createElement(f.Z,{divided:!0,verticalAlign:"middle",relaxed:"very",width:10},ke?s.createElement(i.pO,null):I.length>0?I.map((function(e,t){var n;return s.createElement(f.Z.Item,{key:t,columns:2,verticalAlign:"middle"},s.createElement(f.Z.Content,{floated:"right"},null!=e&&e.connected?s.createElement(p.Z,{basic:!0,color:"red",onClick:function(){re(e),ue(!0)}},"Disconnect"):null,s.createElement(p.Z,{className:e.connected?1===t?"mt-4":"":1===t?"ml-4 mt-4":"ml-4",color:e.connected?"red":"orange",onClick:function(){M(t),se(e),ge(!0)}},"Regenerate token")),s.createElement(f.Z.Content,null,s.createElement(f.Z.Header,{className:1==t?"mt-4":""},(null==e?void 0:e.connected)?s.createElement(u.Z,{name:"check circle",color:"green",className:"mr-1"}):s.createElement(u.Z,{name:"times circle",color:"red",className:"mr-1"}),s.createElement("strong",null,null==e||null===(n=e.agent)||void 0===n?void 0:n.displayName)),s.createElement(f.Z.Description,{className:"mt-2 ml-1"},"Users with an account in this user store connected via this agent, can sign in to the My Account and other business applications registered in the organization.")))})):s.createElement(i.$J,{title:"No Agents Connected",subtitle:["There are no user store agent connections.","Please go through the setup guide to configure the user store agent(s)."]}),1===I.length&&s.createElement(f.Z.Item,{columns:2,verticalAlign:"middle"},s.createElement(f.Z.Content,{floated:"right"},s.createElement(p.Z,{className:"mt-4",color:"orange",onClick:function(){var e={userStoreId:k};(0,y.generateToken)(e).then((function(e){Y(e.token),he(!0)}))}},"Generate token")),s.createElement(f.Z.Content,null,s.createElement(f.Z.Header,{className:"mt-4"},s.createElement(u.Z,{name:"times circle",color:"red",className:"mr-1"}),s.createElement("strong",null,"On-Prem-Agent-2")),s.createElement(f.Z.Description,{className:"mt-2 ml-1"},U("extensions:manage.features.userStores.edit.general.connectionsSections.agents.agentTwo.description"),s.createElement(i.eb,{link:V("manage.userStores.highAvailability.learnMore")},U("extensions:common.learnMore")))))))),s.createElement(m.Z,{hidden:!0}),s.createElement(m.Z,{hidden:!0}),oe&&s.createElement(i.cV,{"data-testid":"".concat(T,"-confirmation-modal"),onClose:function(){return ue(!1)},type:"warning",open:le,assertionHint:U("user:deleteUser.confirmationModal.assertionHint"),assertionType:"checkbox",primaryAction:U("common:confirm"),secondaryAction:U("common:cancel"),onSecondaryActionClick:function(){ue(!1),Ue(null)},onPrimaryActionClick:function(){return function(e){(0,y.disconnectAgentConnection)(k,e.agent.Id).then((function(){ue(!1),Pe()}))}(oe)},closeOnDimmerClick:!1},s.createElement(i.cV.Header,{"data-testid":"".concat(T,"-confirmation-modal-header")},U("user:deleteUser.confirmationModal.header")),s.createElement(i.cV.Message,{"data-testid":"".concat(T,"-confirmation-modal-message"),attached:!0,warning:!0},"This action is irreversible and will disconnect the user store agent connection."),s.createElement(i.cV.Content,null,s.createElement("div",{className:"modal-alert-wrapper"}," ",Te&&Ne),"If you disconnect the user store agent connection users onboarded from the remote user store will not be able to log in to My Account or any other applications onboarded in Asgardeo.")),ie&&s.createElement(i.cV,{"data-testid":"".concat(T,"-confirmation-modal"),onClose:function(){return ge(!1)},type:"warning",open:me,assertionHint:U("user:deleteUser.confirmationModal.assertionHint"),assertionType:"checkbox",primaryAction:U("common:confirm"),secondaryAction:U("common:cancel"),onSecondaryActionClick:function(){ge(!1),Ue(null)},onPrimaryActionClick:function(){return function(e){var t={existingTokenId:e.tokenId,userStoreId:k};(0,y.regenerateToken)(t).then((function(e){0===H?_(e.token):G(e.token),ge(!1),Ce(!0),se(null)}))}(ie)},closeOnDimmerClick:!1},s.createElement(i.cV.Header,{"data-testid":"".concat(T,"-confirmation-modal-header")},U("user:deleteUser.confirmationModal.header")),s.createElement(i.cV.Message,{"data-testid":"".concat(T,"-confirmation-modal-message"),attached:!0,warning:!0},"This action is irreversible and will revoke the previously used installation token."),s.createElement(i.cV.Content,null,s.createElement("div",{className:"modal-alert-wrapper"}," ",Te&&Ne),"If you regenerate the token the users with the previous token will no longer be authorised to run the user store agent with that token. You will also need to restart the user store agent as revoking the previous token will disconnect the agent..")),!Ve&&s.createElement(i.v9,{sectionHeader:U("common:dangerZone"),"ata-testid":"".concat(T,"-danger-zone-group")},s.createElement(i.cN,{actionTitle:U("userstores:dangerZone.disable.actionTitle"),header:"Disable User Store",subheader:U("userstores:dangerZone.disable.subheader"),onActionClick:void 0,"data-testid":"".concat(T,"-delete-danger-zone"),toggle:{checked:void 0!==C?"true"===C:"false"===(null==b||null===(S=b.properties)||void 0===S||null===(S=S.find((function(e){return e.name===E.rr})))||void 0===S?void 0:S.value),onChange:function(e,t){var n,a=null==Z||null===(n=Z.basic.required)||void 0===n||null===(n=n.find((function(e){return(null==e?void 0:e.name)===E.rr})))||void 0===n?void 0:n.name,i={operation:"REPLACE",path:"/properties/".concat(a),value:t.checked?"true":"false"};(0,v.Xv)(k,[i]).then((function(){w(t.checked.toString()),N((0,r.V_)({description:U("userstores:notifications.updateUserstore.success.description"),level:o.QU.SUCCESS,message:U("userstores:notifications.updateUserstore.success.message")})),N((0,r.V_)({description:U("userstores:notifications.updateDelay.description"),level:o.QU.WARNING,message:U("userstores:notifications.updateDelay.message")}))})).catch((function(e){N((0,r.V_)({description:(null==e?void 0:e.description)||U("userstores:notifications.updateUserstore.genericError.description"),level:o.QU.ERROR,message:(null==e?void 0:e.message)||U("userstores:notifications.updateUserstore.genericError.message")}))}))}}}),s.createElement(i.cN,{actionTitle:U("userstores:dangerZone.delete.actionTitle"),header:U("userstores:dangerZone.delete.header"),subheader:U("userstores:dangerZone.delete.subheader"),onActionClick:function(){return ye(!0)},"data-testid":"".concat(T,"-delete-danger-zone")})),Ee&&s.createElement(i.cV,{onClose:function(){return ye(!1)},type:"negative",open:Ee,assertion:null==b?void 0:b.name,assertionHint:U("extensions:manage.features.userStores.delete.assertionHint"),assertionType:"checkbox",primaryAction:U("userstores:confirmation.confirm"),secondaryAction:U("common:cancel"),onSecondaryActionClick:function(){return ye(!1)},onPrimaryActionClick:function(){(0,v.oA)(k).then((function(){N((0,r.V_)({description:U("userstores:notifications.deleteUserstore.success.description"),level:o.QU.SUCCESS,message:U("userstores:notifications.deleteUserstore.success.message")})),N((0,r.V_)({description:U("userstores:notifications.delay.description"),level:o.QU.WARNING,message:U("userstores:notifications.delay.message")})),h.m8.push(h.$x.getPaths().get("USERSTORES"))})).catch((function(e){var t,n;N((0,r.V_)({description:null!==(t=null==e?void 0:e.description)&&void 0!==t?t:U("userstores:notifications.deleteUserstore.genericError.description"),level:o.QU.ERROR,message:null!==(n=null==e?void 0:e.message)&&void 0!==n?n:U("userstores:notifications.deleteUserstore.genericError.message")}))})).finally((function(){ye(!1)}))},"data-testid":"".concat(T,"-delete-confirmation-modal"),closeOnDimmerClick:!1},s.createElement(i.cV.Header,{"data-testid":"".concat(T,"-delete-confirmation-modal-header")},U("userstores:confirmation.header")),s.createElement(i.cV.Message,{attached:!0,negative:!0,"data-testid":"".concat(T,"-delete-confirmation-modal-message")},U("userstores:confirmation.message")),s.createElement(i.cV.Content,{"data-testid":"".concat(T,"-delete-confirmation-modal-content")},U("userstores:confirmation.content"))),(W||K)&&s.createElement(i.cV,{onClose:function(){return Ce(!1)},type:"warning",open:Se,secondaryAction:U("common:close"),onSecondaryActionClick:function(){Ce(!1),X(null),F(null)}},s.createElement(i.cV.Header,{"data-testid":"".concat(T,"-delete-confirmation-modal-header")},"New Installation Token"),s.createElement(i.cV.Content,{"data-testid":"".concat(T,"-delete-confirmation-modal-content")},W&&s.createElement(d.Z,{className:"mt-2 mb-2"},s.createElement(d.Z.Row,null,s.createElement(d.Z.Column,{width:16},s.createElement(i.v0,{content:"Make sure to note down the installation token as it will be required when running the user store agent. You won\u2019t be able to see it again!",type:"warning"}),s.createElement("label",null,"Installation token"),s.createElement(i.OR,{value:D||"","data-testid":"".concat(T,"-client-secret-readonly-input")})))),K&&s.createElement(d.Z,{className:"mt-2 mb-2"},s.createElement(d.Z.Row,null,s.createElement(d.Z.Column,{width:16},s.createElement(i.v0,{content:"Make sure to note down the installation token as it will be required when running the user store agent. You won't be able to see it again!",type:"info"}),s.createElement("label",null,"Installation token"),s.createElement(i.OR,{value:q||"","data-testid":"".concat(T,"-client-secret-readonly-input")})))))),ee&&s.createElement(i.cV,{onClose:function(){return he(!1)},type:"warning",open:pe,secondaryAction:U("common:close"),onSecondaryActionClick:function(){he(!1),te(null)}},s.createElement(i.cV.Header,{"data-testid":"".concat(T,"-delete-confirmation-modal-header")},"New Installation Token"),s.createElement(i.cV.Content,{"data-testid":"".concat(T,"-delete-confirmation-modal-content")},ee&&s.createElement(d.Z,{className:"mt-2 mb-2"},s.createElement(d.Z.Row,null,s.createElement(d.Z.Column,{width:16},s.createElement(i.v0,{content:"Make sure to note down the installation token as it will be required when running the user store agent. You won't be able to see it again!",type:"warning"}),s.createElement("label",null,"Installation token"),s.createElement(i.OR,{value:z||"","data-testid":"".concat(T,"-client-secret-readonly-input")})))))))}}}]);