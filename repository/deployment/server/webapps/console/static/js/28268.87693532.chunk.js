"use strict";(self.webpackChunk_wso2is_console=self.webpackChunk_wso2is_console||[]).push([[28268],{28268:(e,n,t)=>{t.r(n),t.d(n,{ScopeForm:()=>g});var i=t(95817),o=t(93129),a=t(3356),s=t(86727),l=t(44194),r=t(10479),c=t(47245),u=t(12638),p=t(89141),d=t(77757),m=t(33040),f=t(14200),h=t(98621);function v(e){return function(e){if(Array.isArray(e))return E(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var i,o,a,s,l=[],r=!0,c=!1;try{if(a=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;r=!1}else for(;!(r=(i=a.call(t)).done)&&(l.push(i.value),l.length!==n);r=!0);}catch(e){c=!0,o=e}finally{try{if(!r&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(c)throw o}}return l}}(e,n)||b(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,n){if(e){if("string"==typeof e)return E(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E(e,n):void 0}}function E(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,i=new Array(n);t<n;t++)i[t]=e[t];return i}var g=function(e){var n=e.appId,t=e.subscribedAPIResource,b=e.isScopesAvailableForUpdate,E=e.bulkChangeAllAuthorizedScopes,g=e["data-componentid"],y=(0,r.$)().t,A=(0,c.I0)(),x=S((0,l.useState)(!1),2),z=x[0],C=x[1],Z=S((0,l.useState)(!0),2),I=Z[0],w=Z[1],k=S((0,l.useState)(null),2),P=k[0],R=k[1],O=S((0,l.useState)(null),2),U=O[0],_=O[1],j=S((0,l.useState)(t.permissions),2),N=j[0],Q=j[1],V=S((0,l.useState)(null),2),F=V[0],K=V[1],T=S((0,l.useState)([]),2),H=T[0],M=T[1],$=S((0,l.useState)([]),2),B=$[0],D=$[1],J=S((0,l.useState)(!1),2),W=J[0],q=J[1],G=S((0,l.useState)(!1),2),L=G[0],X=G[1],Y=z||null===P||null===U||null===F;(0,l.useEffect)((function(){var e,n=[];null===(e=t.allPermissions)||void 0===e||e.forEach((function(e){n.push({content:l.createElement(u.Z,{as:"h6",className:"header-with-icon","data-componentId":"".concat(g,"-heading")},l.createElement(u.Z.Content,null,e.displayName,l.createElement(u.Z.Subheader,null,l.createElement(s.EK,{withBackground:!0},e.name)))),key:e.name,text:e.displayName,value:e.name})})),R(n)}),[t]),(0,l.useEffect)((function(){var e=[];t.permissions.forEach((function(n){e.push(n.name)})),_(e),K(e)}),[t]),(0,l.useEffect)((function(){var e;q((null===(e=t.allPermissions)||void 0===e?void 0:e.length)===(null==F?void 0:F.length))}),[F,t]),(0,l.useEffect)((function(){X(0===(null==F?void 0:F.length))}),[F]);var ee=function(e,n){var t=e.map((function(e){return e.name}));n?(0!==(null==U?void 0:U.toString().length)?w(!1):w(!0),Q([]),K([]),D(U),M([])):(U.toString()!==t.toString()?w(!1):w(!0),Q(e),K(t),M(t.filter((function(e){return!U.includes(e)}))),D([]))};return l.createElement(s.pJ,{padded:"very"},Y?null===F||null===P||null===U||z?l.createElement(s.pO,{inline:"centered",active:!0}):null:l.createElement(p.Z,null,l.createElement(p.Z.Row,{columns:1},l.createElement(p.Z.Column,null,l.createElement(d.Z,null,l.createElement(d.Z.Field,null,l.createElement(p.Z,null,l.createElement(p.Z.Row,{columns:2},l.createElement(p.Z.Column,{className:"pb-1",floated:"left",stretched:!0,verticalAlign:"bottom"},l.createElement("label",null,y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.label"))),l.createElement(p.Z.Column,{floated:"right",textAlign:"right"},b&&l.createElement(s.xv,{className:"mb-0",muted:!0,subHeading:!0,size:12},l.createElement(i.Z,{variant:"text",size:"small",tabIndex:6,disabled:W,onClick:function(){return ee(t.allPermissions?t.allPermissions:[],!1)}},y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.selectAll")),"|",l.createElement(i.Z,{variant:"text",size:"small",tabIndex:7,disabled:L,onClick:function(){return ee(t.allPermissions?t.allPermissions:[],!0)}},y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.selectNone")))))),l.createElement(m.Z,{placeholder:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.placeholder"),fluid:!0,multiple:!0,search:!0,selection:!0,options:P||[],defaultValue:U,value:F,onChange:function(e,n){var i=n.value;if(K(i),i.toString()!==U.toString()?w(!1):w(!0),i.length>=N.length){var o,a=null===(o=t.allPermissions)||void 0===o?void 0:o.find((function(e){return e.name===i[i.length-1]}));a&&Q([].concat(v(N),[a])),U.includes(a.name)||M([].concat(v(H),[a.name])),B.includes(a.name)&&D(B.filter((function(e){return e!==a.name})))}else{var s=null==N?void 0:N.filter((function(e){return!i.includes(e.name)}))[0];s&&Q(N.filter((function(e){return e.name!==s.name}))),U.includes(s.name)&&D([].concat(v(B),[s.name])),H.includes(s.name)&&M(H.filter((function(e){return e!==s.name})))}},disabled:!b}),l.createElement(s.kW,null,y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.scopesSection.hint")))))),b&&l.createElement(p.Z.Row,null,l.createElement(p.Z.Column,{floated:"left"},l.createElement(s.Qj,{size:"small",floated:"left",tabIndex:8,onClick:function(){K(U),Q(t.permissions),M([]),D([]),w(!0)},"data-componentid":"".concat(g,"-cancel-btn"),disabled:I},y("common:cancel")),l.createElement(s.KM,{size:"small",floated:"right",tabIndex:9,onClick:function(){C(!0),(0,h.patchScopesOfAPIResource)(n,null==t?void 0:t.apiId,H,B).then((function(){var e,n;A((0,a.V_)({description:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.success.description"),level:o.QU.SUCCESS,message:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.success.message")}));var i=null===(e=t.allPermissions)||void 0===e?void 0:e.map((function(e){if(H.includes(e.name))return e})).filter((function(e){return void 0!==e})),s=null===(n=t.allPermissions)||void 0===n?void 0:n.map((function(e){if(B.includes(e.name))return e})).filter((function(e){return void 0!==e}));0!==(null==i?void 0:i.length)&&E(i,!1),0!==(null==s?void 0:s.length)&&E(s,!0),M([]),D([]),_(F),w(!0)})).catch((function(e){if((null==e?void 0:e.code)===f.K.UNAUTHORIZED_ACCESS)A((0,a.V_)({description:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.unauthorizedError.description"),level:o.QU.ERROR,message:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.unauthorizedError.message")}));else A((0,a.V_)({description:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.genericError.description"),level:o.QU.ERROR,message:y("extensions:develop.applications.edit.sections.apiAuthorization.sections.apiSubscriptions.notifications.patchScopes.genericError.message")}))})).finally((function(){return C(!1)}))},"data-componentid":"".concat(g,"-update-btn"),disabled:I},y("extensions:develop.applications.edit.sections.apiAuthorization.sections.policySection.buttons.update"))))))};g.defaultProps={"data-componentid":"permission-form"}}}]);